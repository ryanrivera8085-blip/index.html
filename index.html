<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Luminu Mobile</title>
<style>
  body { margin:0; background:black; overflow:hidden; touch-action:none; }
  canvas { display:block; }

  .btn {
    position: absolute;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: rgba(0,200,255,0.3);
    border: 2px solid cyan;
    color: white;
    font-size: 12px;
  }

  #destello { right: 20px; bottom: 180px; }
  #escudo   { right: 100px; bottom: 100px; }
  #pulso    { right: 20px; bottom: 100px; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<button class="btn" id="destello">Destello</button>
<button class="btn" id="escudo">Escudo</button>
<button class="btn" id="pulso">Pulso</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

const destelloBtn = document.getElementById("destello");
const escudoBtn = document.getElementById("escudo");
const pulsoBtn = document.getElementById("pulso");

// üîπ LUMINU üîπ
let luminu = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  r: 20,
  life: 100,
  shield: false
};

let enemies = [];
let pulses = [];
let pulsoReady = true;

// üëæ CREAR ENEMIGOS
function spawnEnemy() {
  enemies.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: 15,
    speed: 0.6
  });
}
setInterval(spawnEnemy, 2000);

// üïπÔ∏è JOYSTICK
let joystick = { active:false, startX:0, startY:0, dx:0, dy:0 };

canvas.addEventListener("touchstart", e => {
  let t = e.touches[0];
  if (t.clientX < canvas.width / 2) {
    joystick.active = true;
    joystick.startX = t.clientX;
    joystick.startY = t.clientY;
  }
});
canvas.addEventListener("touchmove", e => {
  if (!joystick.active) return;
  let t = e.touches[0];
  joystick.dx = t.clientX - joystick.startX;
  joystick.dy = t.clientY - joystick.startY;
});
canvas.addEventListener("touchend", () => {
  joystick.active = false;
  joystick.dx = joystick.dy = 0;
});

// ‚ú® HABILIDADES
function escudo() {
  luminu.shield = true;
  setTimeout(() => luminu.shield = false, 3000);
}

function pulso() {
  if (!pulsoReady) return;

  pulsoReady = false;
  pulses.push({ r: 0, max: 220 });

  // ‚è±Ô∏è COOLDOWN 5s
  setTimeout(() => pulsoReady = true, 5000);
}

escudoBtn.onclick = escudo;
pulsoBtn.onclick = pulso;

// üîÅ LOOP
function update() {
  // Movimiento Luminu
  luminu.x += joystick.dx * 0.03;
  luminu.y += joystick.dy * 0.03;

  // üëæ Enemigos persiguen
  enemies.forEach(e => {
    let dx = luminu.x - e.x;
    let dy = luminu.y - e.y;
    let dist = Math.hypot(dx, dy);
    e.x += (dx / dist) * e.speed;
    e.y += (dy / dist) * e.speed;

    // Da√±o
    if (dist < luminu.r + e.r && !luminu.shield) {
      luminu.life -= 0.3;
    }
  });

  // üí• Pulso elimina SOLO en rango
  pulses.forEach((p, pi) => {
    p.r += 6;
    enemies = enemies.filter(e =>
      Math.hypot(luminu.x - e.x, luminu.y - e.y) > p.r
    );
    if (p.r > p.max) pulses.splice(pi, 1);
  });

  if (luminu.life <= 0) {
    alert("GAME OVER");
    location.reload();
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Luminu
  ctx.beginPath();
  ctx.arc(luminu.x, luminu.y, luminu.r, 0, Math.PI * 2);
  ctx.fillStyle = "white";
  ctx.fill();

  // Escudo
  if (luminu.shield) {
    ctx.beginPath();
    ctx.arc(luminu.x, luminu.y, luminu.r + 10, 0, Math.PI * 2);
    ctx.strokeStyle = "cyan";
    ctx.lineWidth = 4;
    ctx.stroke();
  }

  // Enemigos
  enemies.forEach(e => {
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.r, 0, Math.PI * 2);
    ctx.fillStyle = "red";
    ctx.fill();
  });

  // Pulso visual
  pulses.forEach(p => {
    ctx.beginPath();
    ctx.arc(luminu.x, luminu.y, p.r, 0, Math.PI * 2);
    ctx.strokeStyle = "blue";
    ctx.lineWidth = 3;
    ctx.stroke();
  });

  // Vida
  ctx.fillStyle = "red";
  ctx.fillRect(20, 20, luminu.life * 2, 10);

  // Cooldown pulso
  ctx.fillStyle = pulsoReady ? "white" : "gray";
  ctx.fillText("Pulso", canvas.width - 70, canvas.height - 30);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>

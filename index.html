<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Luminu 3D</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }

/* UI */
#ui-left {
  position:absolute;
  left:20px;
  bottom:20px;
  z-index:10;
}
#ui-right {
  position:absolute;
  right:20px;
  top:40%;
  font-size:100px;
  color:white;
  z-index:10;
}
#joystick {
  width:120px;
  height:120px;
  border-radius:50%;
  background:rgba(255,255,255,0.15);
  margin-bottom:10px;
}
.btn {
  width:120px;
  padding:10px;
  margin-top:8px;
  border-radius:12px;
  border:none;
  background:#00cfd1;
  font-size:16px;
}

#bossBar {
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  width:220px;
  height:14px;
  background:#400;
  display:none;
}
#bossLife {
  height:100%;
  width:100%;
  background:red;
}
</style>
</head>

<body>

<!-- UI -->
<div id="ui-left">
  <div id="joystick"></div>
  <button class="btn" id="pulseBtn">PULSO</button>
  <button class="btn" id="shieldBtn">ESCUDO</button>
</div>

<div id="ui-right">üßç</div>

<div id="bossBar"><div id="bossLife"></div></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152/build/three.min.js"></script>

<script>
/* ===== ESCENA ===== */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 100);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff, 1));

/* ===== SUELO ===== */
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(100,100),
  new THREE.MeshBasicMaterial({color:0x111111})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

/* ===== JUGADOR ===== */
const player = new THREE.Group();
const body = new THREE.Mesh(
  new THREE.BoxGeometry(1,1.6,0.6),
  new THREE.MeshBasicMaterial({color:0xffffff})
);
body.position.y = 0.8;
player.add(body);
scene.add(player);

/* ===== VARIABLES ===== */
let moveX=0, moveY=0;
let zombies=[];
let kills=0;
let boss=null;
let pulseReady=true;
let shieldLife=0;

/* ===== C√ÅMARA 3RA PERSONA ===== */
function updateCamera(){
  const offset = new THREE.Vector3(0,4,7);
  camera.position.copy(player.position).add(offset);
  camera.lookAt(player.position);
}

/* ===== JOYSTICK ===== */
const joystick = document.getElementById("joystick");
joystick.addEventListener("touchmove", e=>{
  const t=e.touches[0];
  const r=joystick.getBoundingClientRect();
  moveX=(t.clientX-(r.left+r.width/2))/50;
  moveY=(t.clientY-(r.top+r.height/2))/50;
  moveX=Math.max(-1,Math.min(1,moveX));
  moveY=Math.max(-1,Math.min(1,moveY));
});
joystick.addEventListener("touchend",()=>{moveX=moveY=0;});

/* ===== ZOMBIES ===== */
function spawnZombie(){
  kills++;
  let type="normal";
  if(kills%15===0) type="boss";
  else if(kills%10===0) type="red";

  if(type==="boss"){
    boss=new THREE.Mesh(
      new THREE.BoxGeometry(3,4,3),
      new THREE.MeshBasicMaterial({color:0x800080})
    );
    boss.position.set(Math.random()*10-5,2,-15);
    boss.hp=10;
    scene.add(boss);
    bossBar.style.display="block";
    bossLife.style.width="100%";
    return;
  }

  const z=new THREE.Mesh(
    new THREE.BoxGeometry(1,1.6,0.6),
    new THREE.MeshBasicMaterial({color:type==="red"?0xff0000:0x00ff00})
  );
  z.position.set(Math.random()*10-5,0.8,-15);
  z.hp=type==="red"?2:1;
  z.speed=type==="red"?0.07:0.045;
  z.damage=type==="red"?3:1;
  scene.add(z);
  zombies.push(z);
}
setInterval(spawnZombie,1500);

/* ===== PULSO ===== */
pulseBtn.onclick=()=>{
  if(!pulseReady) return;
  pulseReady=false;

  zombies=zombies.filter(z=>{
    if(z.position.distanceTo(player.position)<5){
      z.hp--;
      if(z.hp<=0){scene.remove(z); return false;}
    }
    return true;
  });

  if(boss && boss.position.distanceTo(player.position)<6){
    boss.hp--;
    bossLife.style.width=(boss.hp/10*100)+"%";
    if(boss.hp<=0){
      scene.remove(boss);
      boss=null;
      bossBar.style.display="none";
    }
  }

  setTimeout(()=>pulseReady=true,5000);
};

/* ===== ESCUDO ===== */
shieldBtn.onclick=()=>{
  shieldLife=5;
};

/* ===== LOOP ===== */
function animate(){
  requestAnimationFrame(animate);

  player.position.x+=moveX*0.12;
  player.position.z+=moveY*0.12;

  zombies.forEach(z=>{
    z.lookAt(player.position);
    z.translateZ(z.speed);
    if(z.position.distanceTo(player.position)<1){
      if(shieldLife>0) shieldLife-=z.damage;
    }
  });

  if(boss){
    boss.lookAt(player.position);
    boss.translateZ(0.02);
  }

  updateCamera();
  renderer.render(scene,camera);
}
animate();

addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>
